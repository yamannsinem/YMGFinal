<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Velora OS - Purple Edition</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script>
    tailwind.config = {
        theme: {
            extend: {
                fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                colors: { 
                    brand: { 
                        500: '#d946ef',  /* Daha canlƒ± Fu≈üya/Mor */
                        600: '#c026d3',
                        dark: '#4a044e'
                    } 
                },
                animation: {
                    'blob': 'blob 7s infinite',
                },
                keyframes: {
                    blob: {
                        '0%': { transform: 'translate(0px, 0px) scale(1)' },
                        '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                        '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                        '100%': { transform: 'translate(0px, 0px) scale(1)' },
                    }
                }
            }
        }
    }
</script>
<style>
    body { 
        background-color: #0f172a; 
        color: #fff; 
        overflow-x: hidden; 
        background-image: radial-gradient(circle at 50% 0%, #2e1065, #0f172a);
    }
    
    .glass { 
        background: rgba(17, 24, 39, 0.4); 
        backdrop-filter: blur(20px); 
        -webkit-backdrop-filter: blur(20px); 
        border: 1px solid rgba(255, 255, 255, 0.08); 
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
    }
    .glass:hover { 
        background: rgba(17, 24, 39, 0.5); 
        border-color: rgba(217, 70, 239, 0.3);
        transform: translateY(-2px); 
        transition: all 0.3s ease; 
    }
    
    .nav-active { 
        background: rgba(217, 70, 239, 0.15); 
        border-left: 3px solid #d946ef; 
        color: #fff; 
        text-shadow: 0 0 10px rgba(217, 70, 239, 0.5);
    }

    .blob-bg {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        z-index: -1;
        overflow: hidden;
    }
    .blob {
        position: absolute;
        filter: blur(80px);
        opacity: 0.4;
        animation: blob 10s infinite alternate;
    }
    .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: #701a75; animation-delay: 0s; }
    .blob-2 { bottom: -10%; right: -10%; width: 600px; height: 600px; background: #4c1d95; animation-delay: 2s; }
    .blob-3 { top: 40%; left: 40%; width: 400px; height: 400px; background: #be185d; animation-delay: 4s; }

    ::-webkit-scrollbar { width: 6px; background: transparent; }
    ::-webkit-scrollbar-thumb { background: #4a044e; border-radius: 10px; }
</style>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col md:flex-row relative">

    <div class="blob-bg">
        <div class="blob blob-1 rounded-full"></div>
        <div class="blob blob-2 rounded-full"></div>
        <div class="blob blob-3 rounded-full"></div>
    </div>

    <div id="toast" class="fixed top-5 right-5 z-[100] transform translate-x-full transition-transform duration-300">
        <div class="glass px-4 py-3 rounded-xl flex items-center gap-3 border-l-4 border-brand-500 shadow-xl shadow-brand-500/20">
            <i class="ri-notification-badge-fill text-brand-500 text-xl"></i>
            <span id="toast-msg" class="text-sm font-medium">Bildirim</span>
        </div>
    </div>

    <div id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="glass w-full max-w-sm p-8 rounded-3xl text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-brand-500 to-transparent opacity-50"></div>
            
            <div class="w-20 h-20 mx-auto bg-gradient-to-tr from-brand-500 to-purple-900 rounded-2xl flex items-center justify-center text-4xl font-bold text-white shadow-lg mb-6 shadow-brand-500/40 border border-white/10">V</div>
            <h1 class="text-3xl font-bold mb-1 tracking-tight">Velora OS</h1>
            <p class="text-slate-300 text-sm mb-8 font-light">Purple Edition</p>

            <div id="login-form" class="space-y-4">
                <div class="group relative">
                    <i class="ri-mail-line absolute left-4 top-3.5 text-slate-400 group-focus-within:text-brand-500 transition"></i>
                    <input id="l-email" type="email" placeholder="E-Posta" class="w-full bg-slate-900/50 border border-white/10 rounded-xl pl-12 pr-4 py-3 outline-none focus:border-brand-500 focus:bg-slate-900/80 transition text-white placeholder-slate-500">
                </div>
                <div class="group relative">
                    <i class="ri-lock-2-line absolute left-4 top-3.5 text-slate-400 group-focus-within:text-brand-500 transition"></i>
                    <input id="l-pass" type="password" placeholder="≈ûifre" class="w-full bg-slate-900/50 border border-white/10 rounded-xl pl-12 pr-4 py-3 outline-none focus:border-brand-500 focus:bg-slate-900/80 transition text-white placeholder-slate-500">
                </div>
                <button type="button" onclick="handleLogin()" class="w-full bg-gradient-to-r from-brand-600 to-purple-700 hover:from-brand-500 hover:to-purple-600 py-3.5 rounded-xl font-bold transition text-white shadow-lg shadow-brand-500/25">Giri≈ü Yap</button>
                <div class="text-xs text-slate-400 mt-6 cursor-pointer hover:text-brand-500 transition" onclick="toggleAuth('reg')">Hesabƒ±n yok mu? <span class="font-bold underline">Kayƒ±t Ol</span></div>
            </div>

            <div id="reg-form" class="space-y-4 hidden">
                <div class="group relative">
                    <i class="ri-user-line absolute left-4 top-3.5 text-slate-400 group-focus-within:text-brand-500 transition"></i>
                    <input id="r-name" type="text" placeholder="Ad Soyad" class="w-full bg-slate-900/50 border border-white/10 rounded-xl pl-12 pr-4 py-3 outline-none focus:border-brand-500 transition text-white">
                </div>
                <div class="group relative">
                    <i class="ri-mail-line absolute left-4 top-3.5 text-slate-400 group-focus-within:text-brand-500 transition"></i>
                    <input id="r-email" type="email" placeholder="E-Posta" class="w-full bg-slate-900/50 border border-white/10 rounded-xl pl-12 pr-4 py-3 outline-none focus:border-brand-500 transition text-white">
                </div>
                <div class="group relative">
                    <i class="ri-key-2-line absolute left-4 top-3.5 text-slate-400 group-focus-within:text-brand-500 transition"></i>
                    <input id="r-pass" type="password" placeholder="≈ûifre" class="w-full bg-slate-900/50 border border-white/10 rounded-xl pl-12 pr-4 py-3 outline-none focus:border-brand-500 transition text-white">
                </div>
                <button type="button" onclick="handleRegister()" class="w-full bg-gradient-to-r from-emerald-600 to-teal-700 hover:from-emerald-500 hover:to-teal-600 py-3.5 rounded-xl font-bold transition text-white shadow-lg shadow-emerald-500/20">Kayƒ±t Ol</button>
                <div class="text-xs text-slate-400 mt-6 cursor-pointer hover:text-brand-500 transition" onclick="toggleAuth('login')">Zaten hesabƒ±n var mƒ±? <span class="font-bold underline">Giri≈ü Yap</span></div>
            </div>
        </div>
    </div>

    <div id="app-screen" class="hidden w-full h-screen flex flex-col md:flex-row">
        <aside class="w-full md:w-72 glass border-r-0 md:border-r flex md:flex-col justify-between p-6 z-40 md:h-full fixed bottom-0 md:relative">
            <div class="hidden md:flex items-center gap-4 px-2 mb-10">
                <div class="w-10 h-10 bg-gradient-to-br from-brand-500 to-purple-800 rounded-xl flex items-center justify-center font-bold text-xl shadow-lg shadow-brand-500/30">V</div>
                <div>
                    <span class="font-bold text-xl tracking-tight block">Velora</span>
                    <span class="text-[10px] text-brand-500 font-bold tracking-widest uppercase">Workspace</span>
                </div>
            </div>
            
            <nav class="flex md:flex-col justify-around md:justify-start gap-2 w-full">
                <button onclick="nav('home')" class="nav-btn p-3.5 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 flex items-center gap-4 transition-all" id="btn-home">
                    <i class="ri-dashboard-line text-xl"></i> 
                    <span class="hidden md:block text-sm font-medium">Genel Bakƒ±≈ü</span>
                </button>
                <button onclick="nav('tasks')" class="nav-btn p-3.5 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 flex items-center gap-4 transition-all" id="btn-tasks">
                    <i class="ri-task-line text-xl"></i> 
                    <span class="hidden md:block text-sm font-medium">G√∂revler</span>
                </button>
                <button onclick="nav('passwords')" class="nav-btn p-3.5 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 flex items-center gap-4 transition-all" id="btn-passwords">
                    <i class="ri-lock-password-line text-xl"></i> 
                    <span class="hidden md:block text-sm font-medium">≈ûifrelerim</span>
                </button>
                <button onclick="nav('notes')" class="nav-btn p-3.5 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 flex items-center gap-4 transition-all" id="btn-notes">
                    <i class="ri-sticky-note-line text-xl"></i> 
                    <span class="hidden md:block text-sm font-medium">Notlarƒ±m</span>
                </button>
            </nav>

            <div class="hidden md:block border-t border-white/10 pt-6 mt-4">
                <div class="glass p-4 rounded-xl mb-4 bg-gradient-to-br from-purple-900/40 to-transparent border-0">
                    <p class="text-xs text-slate-400 mb-1">Aktif Kullanƒ±cƒ±</p>
                    <p class="text-sm font-bold text-white truncate" id="sidebar-user-name">...</p>
                </div>
                <button onclick="logout()" class="w-full flex items-center gap-3 p-3 text-rose-400 hover:bg-rose-500/10 hover:text-rose-300 rounded-xl text-sm transition-all font-medium">
                    <i class="ri-logout-circle-line text-lg"></i> G√ºvenli √áƒ±kƒ±≈ü
                </button>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto p-4 md:p-10 pb-24 md:pb-10 relative">
            <header class="flex justify-between items-end mb-10">
                <div>
                    <h2 class="text-4xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400">Ho≈ü Geldin</h2>
                    <p class="text-brand-500 font-medium" id="user-display">Kullanƒ±cƒ±</p>
                </div>
                <button onclick="logout()" class="md:hidden w-12 h-12 rounded-full glass flex items-center justify-center text-rose-400 shadow-lg"><i class="ri-logout-box-line text-xl"></i></button>
            </header>

            <div id="view-home" class="view space-y-8">
                <div class="glass p-8 rounded-[2rem] bg-gradient-to-r from-brand-900/40 via-purple-900/20 to-transparent border border-white/10 relative overflow-hidden group">
                    <div class="absolute right-0 top-0 w-64 h-64 bg-brand-500/20 blur-[80px] rounded-full group-hover:bg-brand-500/30 transition duration-1000"></div>
                    <div class="relative z-10">
                        <div class="flex items-start gap-4 mb-4">
                            <div class="p-3 bg-brand-500/20 rounded-2xl text-brand-500">
                                <i class="ri-cpu-line text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold">Sistem Durumu</h3>
                                <p class="text-slate-400 text-sm">Velora AI Engine</p>
                            </div>
                        </div>
                        <p class="text-2xl font-light italic text-slate-200">"Sistem sorunsuz √ßalƒ±≈üƒ±yor. Yeni g√∂revler i√ßin hazƒ±rƒ±m."</p>
                        <div class="mt-6 flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                            <span class="text-xs font-bold text-emerald-400 tracking-wider">ONLINE</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass p-6 rounded-3xl hover:bg-white/5 transition cursor-pointer" onclick="nav('tasks')">
                        <div class="flex justify-between items-start mb-8">
                            <div class="p-3 bg-blue-500/20 rounded-xl text-blue-400"><i class="ri-checkbox-multiple-line text-xl"></i></div>
                            <i class="ri-arrow-right-up-line text-slate-500"></i>
                        </div>
                        <h4 class="text-3xl font-bold mb-1" id="stat-task-count">-</h4>
                        <p class="text-slate-400 text-sm">Bekleyen G√∂rev</p>
                    </div>
                    <div class="glass p-6 rounded-3xl">
                        <div class="flex justify-between items-start mb-8">
                            <div class="p-3 bg-orange-500/20 rounded-xl text-orange-400"><i class="ri-shield-keyhole-line text-xl"></i></div>
                            <i class="ri-more-fill text-slate-500"></i>
                        </div>
                        <h4 class="text-3xl font-bold mb-1">G√ºvenli</h4>
                        <p class="text-slate-400 text-sm">Baƒülantƒ± ≈ûifreli</p>
                    </div>
                </div>
            </div>
            
            <div id="view-tasks" class="view hidden space-y-6">
                 <div class="glass p-3 rounded-2xl flex gap-3 shadow-lg shadow-black/20">
                    <div class="flex-1 relative">
                        <i class="ri-add-circle-line absolute left-4 top-3.5 text-slate-400 text-xl"></i>
                        <input id="inp-task" type="text" placeholder="Yeni bir g√∂rev ekle..." class="w-full bg-transparent pl-12 pr-4 py-3 outline-none text-white placeholder-slate-500 font-medium">
                    </div>
                    <button onclick="addTask()" class="bg-brand-600 px-8 py-2 rounded-xl font-bold hover:bg-brand-500 transition text-white shadow-lg shadow-brand-500/20 flex items-center gap-2">
                        <span>Ekle</span> <i class="ri-send-plane-fill"></i>
                    </button>
                </div>
                <div id="list-tasks" class="grid gap-3"></div>
            </div>

            <div id="view-passwords-lock" class="view hidden flex flex-col items-center justify-center h-[60vh] text-center space-y-6">
                <div class="relative">
                    <div class="absolute inset-0 bg-brand-500 blur-[60px] opacity-20 rounded-full"></div>
                    <div class="relative glass w-24 h-24 rounded-full flex items-center justify-center text-4xl text-brand-400 mb-4 shadow-2xl shadow-brand-500/20">
                        <i class="ri-lock-2-fill"></i>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-2xl font-bold mb-2">Velora Kasa Kilitli</h3>
                    <p class="text-slate-400 max-w-xs mx-auto">≈ûifrelerinizi g√∂r√ºnt√ºlemek i√ßin l√ºtfen Velora giri≈ü ≈üifrenizle kimliƒüinizi doƒürulayƒ±n.</p>
                </div>

                <div class="glass p-2 rounded-xl flex items-center gap-2 w-full max-w-xs border border-white/10 focus-within:border-brand-500 transition-colors">
                    <i class="ri-key-fill text-slate-500 ml-3"></i>
                    <input id="vault-pass" type="password" placeholder="Giri≈ü ≈ûifresi" class="bg-transparent border-none outline-none text-white flex-1 py-2 placeholder-slate-600" onkeypress="handleVaultEnter(event)">
                    <button onclick="unlockVault()" class="bg-brand-600 hover:bg-brand-500 text-white w-10 h-10 rounded-lg flex items-center justify-center transition shadow-lg shadow-brand-500/20">
                        <i class="ri-arrow-right-line"></i>
                    </button>
                </div>
            </div>

            <div id="view-passwords" class="view hidden space-y-6">
                <div class="glass p-5 rounded-2xl shadow-lg shadow-black/20">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2"><i class="ri-shield-keyhole-fill text-brand-500"></i> Yeni ≈ûifre Kaydet</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <input id="p-account" type="text" placeholder="Platform (√ñrn: Instagram)" class="bg-slate-900/50 border border-white/10 rounded-xl px-4 py-3 outline-none text-white focus:border-brand-500">
                        <input id="p-username" type="text" placeholder="Kullanƒ±cƒ± Adƒ±" class="bg-slate-900/50 border border-white/10 rounded-xl px-4 py-3 outline-none text-white focus:border-brand-500">
                        <div class="relative">
                            <input id="p-password" type="text" placeholder="≈ûifre" class="w-full bg-slate-900/50 border border-white/10 rounded-xl px-4 py-3 outline-none text-white focus:border-brand-500">
                            <button onclick="addPassword()" class="absolute right-2 top-2 bottom-2 bg-brand-600 hover:bg-brand-500 px-4 rounded-lg font-bold transition text-white">Kaydet</button>
                        </div>
                    </div>
                </div>
                <div id="list-passwords" class="grid gap-3 grid-cols-1 md:grid-cols-2"></div>
            </div>

            <div id="view-notes" class="view hidden space-y-6">
                <div class="glass p-4 rounded-2xl flex flex-col md:flex-row gap-3 shadow-lg shadow-black/20 items-center">
                    <input id="note-title" type="text" placeholder="Ba≈ülƒ±k..." class="bg-transparent border-b border-white/10 px-2 py-2 outline-none text-white font-bold w-full md:w-1/4 focus:border-brand-500 transition">
                    <input id="note-content" type="text" placeholder="Notunu buraya yaz..." class="bg-transparent border-b border-white/10 px-2 py-2 outline-none text-white flex-1 focus:border-brand-500 transition">
                    
                    <div class="flex items-center gap-2" id="color-picker">
                        <button type="button" onclick="selectColor('#f59e0b', this)" class="w-8 h-8 rounded-full border-2 border-white bg-amber-500 transition transform scale-110 ring-2 ring-offset-2 ring-offset-slate-900 ring-white"></button>
                        <button type="button" onclick="selectColor('#3b82f6', this)" class="w-8 h-8 rounded-full border-2 border-transparent bg-blue-500 transition transform hover:scale-105"></button>
                        <button type="button" onclick="selectColor('#10b981', this)" class="w-8 h-8 rounded-full border-2 border-transparent bg-emerald-500 transition transform hover:scale-105"></button>
                        <button type="button" onclick="selectColor('#ec4899', this)" class="w-8 h-8 rounded-full border-2 border-transparent bg-pink-500 transition transform hover:scale-105"></button>
                        <button type="button" onclick="selectColor('#8b5cf6', this)" class="w-8 h-8 rounded-full border-2 border-transparent bg-violet-500 transition transform hover:scale-105"></button>
                    </div>

                    <button onclick="addNote()" class="bg-brand-600 hover:bg-brand-500 px-6 py-2 rounded-xl font-bold transition text-white shadow-lg shadow-brand-500/20 whitespace-nowrap">
                        Kaydet
                    </button>
                </div>
                <div id="list-notes" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>

        </main>
    </div>

<script>
    const API = "http://localhost:8000"; 
    
    let token = localStorage.getItem('token');
    let uid = localStorage.getItem('uid');
    
    // YENƒ∞: Global Renk Deƒüi≈ükeni
    let selectedColor = "#f59e0b";

    window.onload = function() {
        if(token && uid) {
            initApp();
        } else {
            document.getElementById('auth-screen').classList.remove('hidden');
        }
    };

    function initApp() {
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('app-screen').classList.remove('hidden');
        const name = localStorage.getItem('name') || 'Kullanƒ±cƒ±';
        document.getElementById('user-display').innerText = name;
        document.getElementById('sidebar-user-name').innerText = name;
        
        loadTasks();
        loadPasswords(); 
        loadNotes(); // Notlarƒ± da y√ºkle
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        document.getElementById('toast-msg').innerText = msg;
        t.classList.remove('translate-x-full');
        setTimeout(() => t.classList.add('translate-x-full'), 3000);
    }
    
    function toggleAuth(type) {
        document.getElementById('login-form').classList.toggle('hidden', type === 'reg');
        document.getElementById('reg-form').classList.toggle('hidden', type !== 'reg');
    }

    function logout() {
        localStorage.clear();
        location.reload();
    }
    
    function nav(viewId) {
        if(viewId === 'passwords') {
            openVaultLock();
            return;
        }
        document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
        document.getElementById('view-' + viewId).classList.remove('hidden');
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('nav-active', 'text-white'));
        document.getElementById('btn-' + viewId).classList.add('nav-active', 'text-white');
    }

    function openVaultLock() {
        document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
        document.getElementById('view-passwords-lock').classList.remove('hidden');
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('nav-active', 'text-white'));
        document.getElementById('btn-passwords').classList.add('nav-active', 'text-white');
        document.getElementById('vault-pass').value = "";
        document.getElementById('vault-pass').focus();
    }

    async function unlockVault() {
        const pass = document.getElementById('vault-pass').value;
        if(!pass) return;
        try {
            const res = await fetch(`${API}/auth/verify`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify({ password: pass })
            });
            if(res.ok) {
                document.getElementById('view-passwords-lock').classList.add('hidden');
                document.getElementById('view-passwords').classList.remove('hidden');
                loadPasswords();
                showToast("üîì Kasa A√ßƒ±ldƒ±");
            } else {
                showToast("‚ùå Yanlƒ±≈ü ≈ûifre!");
                document.getElementById('vault-pass').classList.add('animate-pulse', 'text-rose-500');
                setTimeout(() => document.getElementById('vault-pass').classList.remove('animate-pulse', 'text-rose-500'), 500);
            }
        } catch(e) { console.log(e); showToast("‚ùå Baƒülantƒ± Hatasƒ±"); }
    }

    function handleVaultEnter(e) { if(e.key === 'Enter') unlockVault(); }

    // --- API FONKSƒ∞YONLARI ---
    async function handleRegister() {
        const name = document.getElementById('r-name').value;
        const email = document.getElementById('r-email').value;
        const pass = document.getElementById('r-pass').value;
        if(!name || !email || !pass) { showToast("‚ö†Ô∏è T√ºm alanlarƒ± doldurun!"); return; }
        try {
            const res = await fetch(`${API}/auth/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ full_name: name, email: email, password: pass })
            });
            const data = await res.json();
            if(res.ok) {
                showToast("‚úÖ Kayƒ±t Ba≈üarƒ±lƒ±! Giri≈ü yapƒ±nƒ±z.");
                toggleAuth('login');
                document.getElementById('l-email').value = email;
            } else {
                showToast("‚ùå " + (data.detail || "Kayƒ±t Ba≈üarƒ±sƒ±z"));
            }
        } catch(e) { showToast("‚ùå Sunucu hatasƒ±!"); }
    }

    async function handleLogin() {
        const email = document.getElementById('l-email').value;
        const pass = document.getElementById('l-pass').value;
        if(!email || !pass) { showToast("‚ö†Ô∏è Bilgileri girin!"); return; }
        try {
            const res = await fetch(`${API}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email, password: pass })
            });
            const data = await res.json();
            if(res.ok) {
                localStorage.setItem('token', data.access_token);
                localStorage.setItem('uid', data.user_id);
                localStorage.setItem('name', data.full_name);
                showToast("‚úÖ Giri≈ü Ba≈üarƒ±lƒ±!");
                setTimeout(() => location.reload(), 1000);
            } else {
                showToast("‚ùå " + (data.detail || "Giri≈ü Hatalƒ±"));
            }
        } catch(e) { showToast("‚ùå Sunucu hatasƒ±!"); }
    }

    async function loadTasks() {
        if(!uid) return;
        try {
            const res = await fetch(`${API}/api/tasks/${uid}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if(res.ok) {
                const tasks = await res.json();
                document.getElementById('stat-task-count').innerText = tasks.length;
                document.getElementById('list-tasks').innerHTML = tasks.map(t => `
                    <div class="glass p-4 rounded-xl flex items-center justify-between group hover:bg-white/5 transition">
                        <div class="flex items-center gap-4">
                            <div class="w-2 h-2 rounded-full ${t.is_completed ? 'bg-emerald-500' : 'bg-brand-500'}"></div>
                            <span class="${t.is_completed ? 'line-through text-slate-500' : 'text-slate-200'} font-medium">${t.title}</span>
                        </div>
                        <button onclick="deleteTask('${t.id}')" class="w-8 h-8 rounded-lg flex items-center justify-center text-slate-500 hover:text-rose-400 hover:bg-rose-500/10 transition opacity-0 group-hover:opacity-100">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </div>
                `).join('');
            }
        } catch(e) { console.log(e); }
    }
    
    async function addTask() {
        const val = document.getElementById('inp-task').value;
        if(!val) return;
        await fetch(`${API}/api/tasks/${uid}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`},
            body: JSON.stringify({title: val})
        });
        document.getElementById('inp-task').value = "";
        loadTasks();
    }

    async function deleteTask(tid) {
        if(!confirm('Silinsin mi?')) return;
        await fetch(`${API}/api/tasks/${uid}/${tid}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        loadTasks();
    }

    async function loadPasswords() {
        if(!uid) return;
        try {
            const res = await fetch(`${API}/api/passwords/${uid}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if(res.ok) {
                const items = await res.json();
                document.getElementById('list-passwords').innerHTML = items.map(p => `
                    <div class="glass p-4 rounded-xl group relative overflow-hidden transition hover:-translate-y-1">
                        <div class="absolute top-0 right-0 p-2 opacity-50 text-[10px] font-bold uppercase tracking-widest ${p.strength === 'G√º√ßl√º' ? 'text-emerald-400' : (p.strength === 'Orta' ? 'text-yellow-400' : 'text-rose-400')}">
                            ${p.strength}
                        </div>
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-xl text-slate-400">
                                <i class="ri-key-2-line"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-white leading-tight">${p.account}</h4>
                                <p class="text-xs text-slate-400">${p.username}</p>
                            </div>
                        </div>
                        <div class="relative group/pass">
                            <div class="bg-black/40 p-2.5 rounded-lg text-center font-mono text-sm text-brand-300 select-all transition-all duration-300 blur-md hover:blur-none cursor-pointer">
                                ${p.password}
                            </div>
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none group-hover/pass:hidden">
                                <i class="ri-eye-off-line text-slate-500 text-xs"></i>
                            </div>
                        </div>
                        <button onclick="deletePassword('${p.id}')" class="absolute bottom-2 right-2 w-8 h-8 rounded-lg flex items-center justify-center text-slate-500 hover:text-rose-400 hover:bg-rose-500/10 transition opacity-0 group-hover:opacity-100">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </div>
                `).join('');
            }
        } catch(e) { console.log(e); }
    }

    async function deletePassword(pid) {
        if(!confirm('Bu ≈üifreyi kasadan silmek istediƒüine emin misin?')) return;
        await fetch(`${API}/api/passwords/${uid}/${pid}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        showToast("üóëÔ∏è ≈ûifre Silindi");
        loadPasswords();
    }

    async function addPassword() {
        const account = document.getElementById('p-account').value;
        const username = document.getElementById('p-username').value;
        const password = document.getElementById('p-password').value;
        if(!account || !password) { showToast("‚ö†Ô∏è Platform ve ≈ûifre giriniz!"); return; }
        await fetch(`${API}/api/passwords/${uid}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`},
            body: JSON.stringify({account, username, password})
        });
        document.getElementById('p-account').value = "";
        document.getElementById('p-username').value = "";
        document.getElementById('p-password').value = "";
        showToast("‚úÖ ≈ûifre Kasaya Eklendi");
        loadPasswords();
    }

    // --- NOT FONKSƒ∞YONLARI VE RENK SE√áƒ∞Mƒ∞ ---
    
    // Renk Se√ßim Fonksiyonu
    function selectColor(color, btn) {
        selectedColor = color;
        // T√ºm butonlardan se√ßili stilini kaldƒ±r
        const buttons = document.querySelectorAll('#color-picker button');
        buttons.forEach(b => {
            b.classList.remove('border-white', 'ring-2', 'ring-offset-2', 'ring-white', 'scale-110');
            b.classList.add('border-transparent');
        });
        // Tƒ±klanana ekle
        btn.classList.remove('border-transparent');
        btn.classList.add('border-white', 'ring-2', 'ring-offset-2', 'ring-white', 'scale-110');
    }

    async function loadNotes() {
        if(!uid) return;
        try {
            const res = await fetch(`${API}/api/notes/${uid}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if(res.ok) {
                const notes = await res.json();
                document.getElementById('list-notes').innerHTML = notes.map(n => `
                    <div class="p-5 rounded-2xl shadow-lg hover:-translate-y-1 transition duration-300 relative group overflow-hidden" style="background: linear-gradient(135deg, ${n.color}20, transparent); border: 1px solid ${n.color}40;">
                        <div class="absolute top-0 right-0 w-16 h-16 blur-[30px] rounded-full opacity-40 pointer-events-none" style="background: ${n.color}"></div>
                        <h4 class="font-bold text-lg mb-2 text-white/90">${n.title}</h4>
                        <p class="text-sm text-slate-300 leading-relaxed mb-6 break-words">${n.content}</p>
                        <div class="absolute bottom-3 right-3 flex gap-2 opacity-0 group-hover:opacity-100 transition">
                            <button onclick="deleteNote('${n.id}')" class="w-8 h-8 rounded-lg bg-black/20 hover:bg-rose-500 hover:text-white text-rose-400 flex items-center justify-center transition">
                                <i class="ri-delete-bin-line"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        } catch(e) { console.log(e); }
    }

    async function addNote() {
        const title = document.getElementById('note-title').value;
        const content = document.getElementById('note-content').value;
        const color = selectedColor; // Deƒüi≈ükenden al

        if(!title || !content) { showToast("‚ö†Ô∏è Ba≈ülƒ±k ve i√ßerik giriniz!"); return; }

        await fetch(`${API}/api/notes/${uid}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`},
            body: JSON.stringify({title, content, color, category: "Genel"})
        });

        document.getElementById('note-title').value = "";
        document.getElementById('note-content').value = "";
        showToast("üìå Not Eklendi");
        loadNotes();
    }

    async function deleteNote(nid) {
        if(!confirm('Not silinsin mi?')) return;
        await fetch(`${API}/api/notes/${uid}/${nid}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        loadNotes();
    }
</script>
</body>
</html>
